#!/bin/bash

# remover - delete all files/folders containing a keyword, but with armor.
KEYWORD="$1"

# Protected paths to avoid accidental self-destruction
PROTECTED_PATHS=("$PREFIX/bin" "$HOME/bin" "/usr/bin" "/bin" "/sbin")

# Emoji flair because why not
WARNING="‚ö†Ô∏è"
DELETED="üóëÔ∏è"
SKIPPED="üõ°Ô∏è"
SUCCESS="‚úÖ"
SEARCHING="üîç"

# Safety check
if [[ -z "$KEYWORD" ]]; then
  echo "$WARNING  Usage: remover [filename keyword]"
  exit 1
fi

echo "$WARNING  This will recursively search for and delete all files and folders containing the keyword \"$KEYWORD\" from the current directory."
read -p "Are you absolutely sure you want to proceed with the search? (y/n): " confirm
if [[ "$confirm" != "y" ]]; then
  echo "Aborted. No files were harmed today. üê±‚Äçüë§"
  exit 1
fi

echo "$SEARCHING Scanning for files and folders matching: \"$KEYWORD\""
MATCHES=()
while IFS= read -r file; do
  MATCHES+=("$file")
done < <(find . -iwholename "*$KEYWORD*" 2>/dev/null)

if [[ ${#MATCHES[@]} -eq 0 ]]; then
  echo "No matching files or folders found."
  exit 0
fi

for file in "${MATCHES[@]}"; do
  skip=0
  for protected in "${PROTECTED_PATHS[@]}"; do
    if [[ "$file" == "$protected"* ]]; then
      echo "$SKIPPED Skipping protected file: $file"
      skip=1
      break
    fi
  done

  if [[ $skip -eq 0 ]]; then
    rm -rf "$file"
    echo "$DELETED Deleted: $file"
  fi
done

echo
echo "$SUCCESS Deletion complete. Protected files untouched like your last relationship. üß†"